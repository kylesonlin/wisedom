import fs from "fs/promises";
import { MARKDOWN_EXTENSION_RE } from "./constants.js";
async function fetchFilePathsFromGitHub({
  user,
  repo,
  branch,
  docsPath,
  outputPath
}) {
  const url = `https://api.github.com/repos/${user}/${repo}/git/trees/${branch}?recursive=1`;
  const response = await fetch(url);
  const data = await response.json();
  if (data.message) {
    console.error(
      "\u274C GitHub API rate limit exceeded, skipping\u2026",
      JSON.stringify(data, null, 2)
    );
    process.exit(0);
  }
  const filePaths = data.tree.filter((item) => item.path.startsWith(docsPath)).map((item) => item.path.replace(docsPath, ""));
  const result = {
    user,
    repo,
    branch,
    docsPath,
    filePaths: filePaths.filter(
      (filePath) => MARKDOWN_EXTENSION_RE.test(filePath)
    )
  };
  const json = JSON.stringify(result, null, 2);
  await fs.writeFile(outputPath, json);
  console.log(`\u2705 Remote files from "${url}" saved!`);
}
export {
  fetchFilePathsFromGitHub
};
